<!DOCTYPE html>
<html>
  <head>
    <title>ASCII Art Jump and Run</title>
    <style>
      body {
        font-family: monospace;
        white-space: pre;
        font-size: 16px;
      }
      #gameCanvas {
        line-height: 1;
      }
    </style>
  </head>
  <body>
    <div id="gameCanvas"></div>
    <script>
      const canvasWidth = 120;
      const canvasHeight = 20;
      const groundLevel = canvasHeight - 2;
      let playerX = 10;
      let playerY = groundLevel;
      let isJumping = false;
      let jumpHeight = 2;
      let gravity = 0.5;
      let yVelocity = 0;
      let jumpsRemaining = 2;
      const keysPressed = {};

      const platforms = [
        { x: 15, y: groundLevel - 4, width: 10 },
        { x: 50, y: groundLevel - 6, width: 15 },
        { x: 80, y: groundLevel - 8, width: 20 },
      ];

      const canvas = Array.from({ length: canvasHeight }, () =>
        Array(canvasWidth).fill(" ")
      );
      const gameCanvas = document.getElementById("gameCanvas");

      function drawTree(x, y) {
        const tree = ["  ^  ", " ^^^ ", "^^^^^", "  |  ", "  |  "];
        for (let i = 0; i < tree.length; i++) {
          for (let j = 0; j < tree[i].length; j++) {
            if (x + j < canvasWidth && y + i < canvasHeight) {
              canvas[y + i][x + j] = tree[i][j];
            }
          }
        }
      }

      function drawCloud(x, y) {
        const cloud = ["  ___  ", " (   ) ", "(     )", " (___) "];
        for (let i = 0; i < cloud.length; i++) {
          for (let j = 0; j < cloud[i].length; j++) {
            if (x + j < canvasWidth && y + i < canvasHeight) {
              canvas[y + i][x + j] = cloud[i][j];
            }
          }
        }
      }

      function drawPlatforms() {
        for (const platform of platforms) {
          for (let x = platform.x; x < platform.x + platform.width; x++) {
            if (x < canvasWidth && platform.y < canvasHeight) {
              canvas[platform.y][x] = "=";
            }
          }
        }
      }

      function renderCanvas() {
        for (let y = 0; y < canvasHeight; y++) {
          for (let x = 0; x < canvasWidth; x++) {
            canvas[y][x] = " ";
          }
        }

        for (let x = 0; x < canvasWidth; x++) {
          canvas[groundLevel + 1][x] = "=";
        }

        drawTree(5, groundLevel - 4);
        drawTree(30, groundLevel - 4);
        drawTree(55, groundLevel - 4);
        drawTree(80, groundLevel - 4);

        drawCloud(20, 3);
        drawCloud(50, 5);
        drawCloud(80, 2);

        drawPlatforms();

        canvas[Math.floor(playerY)][playerX] = "@";

        gameCanvas.textContent = canvas.map((row) => row.join("")).join("\n");
      }

      document.addEventListener("keydown", (e) => {
        keysPressed[e.key] = true;
      });

      document.addEventListener("keyup", (e) => {
        keysPressed[e.key] = false;
      });

      function checkPlatformCollision(newY) {
        const playerBottom = Math.floor(newY) + 1;
        for (const platform of platforms) {
          if (
            playerX >= platform.x &&
            playerX < platform.x + platform.width &&
            playerBottom > platform.y &&
            playerBottom <= platform.y + 1
          ) {
            return platform.y;
          }
        }
        return null;
      }

      function gameLoop() {
        if (keysPressed["ArrowRight"]) {
          playerX = Math.min(canvasWidth - 1, playerX + 1);
        } else if (keysPressed["ArrowLeft"]) {
          playerX = Math.max(0, playerX - 1);
        }

        if (keysPressed[" "] && jumpsRemaining > 0) {
          isJumping = true;
          jumpsRemaining--;
          yVelocity = -jumpHeight;
          keysPressed[" "] = false; // Prevent continuous jumping
        }

        if (isJumping) {
          const newY = playerY + yVelocity;
          const platformY = checkPlatformCollision(newY);

          if (platformY !== null) {
            playerY = platformY - 1;
            isJumping = false;
            jumpsRemaining = 2;
            yVelocity = 0;
          } else if (newY >= groundLevel) {
            playerY = groundLevel;
            isJumping = false;
            jumpsRemaining = 2;
            yVelocity = 0;
          } else {
            playerY = newY;
            yVelocity += gravity;
          }
        } else {
          const newY = playerY + gravity;
          const platformY = checkPlatformCollision(newY);

          if (platformY !== null) {
            playerY = platformY - 1;
          } else if (newY >= groundLevel) {
            playerY = groundLevel;
          } else {
            playerY = newY;
            isJumping = true;
          }
        }

        renderCanvas();
        requestAnimationFrame(gameLoop);
      }

      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
